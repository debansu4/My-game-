<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cosmic Defender | Space Shooter</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.stars.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&display=swap');
body { margin:0; overflow:hidden; font-family: 'Orbitron', sans-serif; background:black; }
#gameCanvas { position: fixed; top:0; left:0; z-index:1; }
#vanta-bg { position: fixed; top:0; left:0; width:100%; height:100%; z-index:0; }
.game-ui { position: fixed; z-index:2; color:white; text-shadow:0 0 10px #00ffff,0 0 20px #0088ff; font-family: 'Press Start 2P', cursive; }
</style>
</head>
<body>

<div id="vanta-bg"></div>

<!-- Game UI -->
<div class="game-ui top-4 left-4">
    <div>Health: <span id="health">100</span></div>
    <div>Score: <span id="score">0</span></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
feather.replace();

// Vanta.js background
VANTA.STARS({ el:"#vanta-bg", mouseControls:true, touchControls:true, gyroControls:false, minHeight:200, minWidth:200, scale:1, scaleMobile:1, color:0x3a86ff, backgroundColor:0x10101a, size:1.5, quantity:3 });

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x:canvas.width/2, y:canvas.height-100, w:50, h:50, speed:6, shooting:false };
let bullets = [];
let enemies = [];
let keys = {};
let score = 0;
let health = 100;
let lastEnemySpawn = 0;

// Keyboard controls
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
document.addEventListener('mousedown', shoot);

function shoot() {
    bullets.push({ x: player.x, y: player.y - player.h/2, radius:5, speed:10 });
}

// Player movement
function movePlayer() {
    if(keys['a'] || keys['arrowleft']) player.x -= player.speed;
    if(keys['d'] || keys['arrowright']) player.x += player.speed;
    if(keys['w'] || keys['arrowup']) player.y -= player.speed;
    if(keys['s'] || keys['arrowdown']) player.y += player.speed;
    // Stay inside canvas
    player.x = Math.max(player.w/2, Math.min(canvas.width - player.w/2, player.x));
    player.y = Math.max(player.h/2, Math.min(canvas.height - player.h/2, player.y));
}

// Enemy spawn
function spawnEnemy() {
    const size = 40;
    enemies.push({ x: Math.random()*(canvas.width-size)+size/2, y: -size, w: size, h: size, speed: Math.random()*2 + 1 });
}

// Collision detection
function checkCollisions() {
    bullets.forEach((b,i) => {
        enemies.forEach((e,j) => {
            if(Math.abs(b.x-e.x)<e.w/2 && Math.abs(b.y-e.y)<e.h/2) {
                bullets.splice(i,1);
                enemies.splice(j,1);
                score += 10;
                document.getElementById('score').textContent = score;
            }
        });
    });
    enemies.forEach((e,i) => {
        if(Math.abs(player.x-e.x)<(player.w+e.w)/2 && Math.abs(player.y-e.y)<(player.h+e.h)/2) {
            enemies.splice(i,1);
            health -= 20;
            document.getElementById('health').textContent = health;
            if(health <= 0) alert("GAME OVER! Score: "+score);
        }
    });
}

// Draw everything
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    // Player
    ctx.fillStyle = '#3a86ff';
    ctx.beginPath();
    ctx.moveTo(player.x, player.y - player.h/2);
    ctx.lineTo(player.x + player.w/2, player.y + player.h/2);
    ctx.lineTo(player.x - player.w/2, player.y + player.h/2);
    ctx.closePath();
    ctx.fill();
    // Bullets
    bullets.forEach(b => {
        ctx.fillStyle = '#ffff00';
        ctx.beginPath(); ctx.arc(b.x,b.y,b.radius,0,Math.PI*2); ctx.fill();
        b.y -= b.speed;
    });
    bullets = bullets.filter(b => b.y > -10);
    // Enemies
    enemies.forEach(e => {
        ctx.fillStyle = '#ff0000';
        ctx.fillRect(e.x - e.w/2, e.y - e.h/2, e.w, e.h);
        e.y += e.speed;
    });
}

// Game loop
function loop() {
    movePlayer();
    if(Date.now() - lastEnemySpawn > 1000){ spawnEnemy(); lastEnemySpawn = Date.now(); }
    checkCollisions();
    draw();
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
